
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุฑุงุณู ุนุจุฏ ุงูุนุฒูุฒ ูููุงุชุณุงุจ</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css">
    <link rel="shortcut icon" href="whatsapp-icon.png" type="image/png">
</head>
<body>
    <div class="container">
        
        <h1 class="app-heading">ูุฑุงุณู ุงููุงุชุณุงุจ ุงููุจุงุดุฑ</h1>
        <p class="description">ุฃุณุฑุน ุทุฑููุฉ ููุชูุงุตูุ ุฃุฏุฎู ุงูุฑูู ูุงุจุฏุฃ ุงููุญุงุฏุซุฉ ููุฑุงู.</p>

        <button id="installButton" class="install-prompt-button" style="display: none;">
            ๐ฒ ุชุซุจูุช ุงูุชุทุจูู
        </button>
        
        <div class="input-group">
            <label for="countryCode">ุงุฎุชุฑ ุงูุฏููุฉ:</label>
            <select id="countryCode" onchange="updateFlagAndCode(this.value)">
                <option value="" disabled selected>... ุฌุงุฑู ุงูุจุญุซ ุนู ูููุนู ุฃู ุงุฎุชุฑ ูุฏููุงู</option>
            </select>
        </div>

        <div class="phone-input-container">
            <div class="country-code-wrapper">
                <span id="currentFlag" class="flag-icon flag-icon-sd"></span>
                <input type="tel" id="codeInput" value="+249" inputmode="numeric" placeholder="+XXX" oninput="checkCodeInput()">
            </div>
            <input type="tel" id="phoneInput" placeholder="ุฃุฏุฎู ุงูุฑูู ุงููุญูู (ุจุฏูู ุงูุฑูุฒ)" inputmode="numeric">
        </div>

        <button onclick="openWhatsApp()">
            <img src="whatsapp-icon.png" alt="WhatsApp Icon" class="icon"> ุจุฏุก ุงููุญุงุฏุซุฉ ุงูุขู
        </button>

        <p class="note">ูุฑุฌู ุงูุชุฃูุฏ ูู ุตุญุฉ ุฑูุฒ ุงูุฏููุฉ ุงููุฏุฎู.</p>
    </div>

    <footer class="app-footer">
        <p>ุฌููุน ุงูุญููู ูุญููุธุฉ &copy; 2025. ุนุจุฏ ุงูุนุฒูุฒ</p>
    </footer>

    <script>
        // ุงููุชุบูุฑ ูุชุฎุฒูู ุญุฏุซ ุงูุชุซุจูุช
        let deferredPrompt; 
        const installButton = document.getElementById('installButton');

        // ************** ููุทู ุงูุชุซุจูุช ุงูููุจุซู (Install Prompt Logic) **************
        
        // ุฅุธูุงุฑ ุงูุฒุฑ ุงููุฎุตุต ุจุดูู ุฏุงุฆู (ุจูุฌุฑุฏ ุชุญููู ุงูุตูุญุฉ)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                installButton.style.display = 'block';
            });
        }
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e; 
        });

        installButton.addEventListener('click', (e) => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        installButton.style.display = 'none'; 
                    }
                    deferredPrompt = null; 
                });
            } else {
                alert('ูุชุซุจูุช ุงูุชุทุจูู: ุงูุชุญ ูุงุฆูุฉ ุงููุชุตูุญ (โฎ) ูุงุฎุชุฑ "ุงูุชุซุจูุช" ุฃู "ุฅุถุงูุฉ ุฅูู ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ".');
            }
        });
        // *******************************************************************
        
        // ุจูุงูุงุช ุงูุฏูู ุงูุนุฑุจูุฉ ูุฌููุจ ุงูุณูุฏุงู
        const countryData = [
            { name: 'ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ', code: '966', iso: 'sa' },
            { name: 'ุงูุณูุฏุงู', code: '249', iso: 'sd' },
            { name: 'ุงูุฅูุงุฑุงุช ุงูุนุฑุจูุฉ ุงููุชุญุฏุฉ', code: '971', iso: 'ae' },
            { name: 'ูุตุฑ', code: '20', iso: 'eg' },
            { name: 'ุงููููุช', code: '965', iso: 'kw' },
            { name: 'ูุทุฑ', code: '974', iso: 'qa' },
            { name: 'ุงูุจุญุฑูู', code: '973', iso: 'bh' },
            { name: 'ุณูุทูุฉ ุนููุงู', code: '968', iso: 'om' },
            { name: 'ุงููุบุฑุจ', code: '212', iso: 'ma' },
            { name: 'ุงูุฌุฒุงุฆุฑ', code: '213', iso: 'dz' },
            { name: 'ุชููุณ', code: '216', iso: 'tn' },
            { name: 'ุงูุฃุฑุฏู', code: '962', iso: 'jo' },
            { name: 'ููุณุทูู', code: '970', iso: 'ps' },
            { name: 'ูุจูุงู', code: '961', iso: 'lb' },
            { name: 'ุงูุนุฑุงู', code: '964', iso: 'iq' },
            { name: 'ุงูููู', code: '967', iso: 'ye' },
            { name: 'ููุจูุง', code: '218', iso: 'ly' },
            { name: 'ููุฑูุชุงููุง', code: '222', iso: 'mr' },
            { name: 'ุงูุตููุงู', code: '252', iso: 'so' },
            { name: 'ุฌูุจูุชู', code: '253', iso: 'dj' },
            { name: 'ุฌุฒุฑ ุงูููุฑ', code: '269', iso: 'km' },
            { name: 'ุณูุฑูุง', code: '963', iso: 'sy' },
            { name: 'ุฌููุจ ุงูุณูุฏุงู', code: '211', iso: 'ss' }
        ];

        const selectElement = document.getElementById('countryCode');
        const currentFlagSpan = document.getElementById('currentFlag');
        const codeInput = document.getElementById('codeInput'); 
        const phoneInput = document.getElementById('phoneInput'); 
        
        function populateCountries() {
            countryData.sort((a, b) => a.name.localeCompare(b.name, 'ar'));
            
            countryData.forEach(country => {
                const option = document.createElement('option');
                option.value = country.code;
                option.setAttribute('data-iso', country.iso);
                option.textContent = `(${country.code}+) ${country.name}`;
                selectElement.appendChild(option);
            });
            // ุงุฎุชูุงุฑ ุงูุณูุฏุงู ููููุฉ ุงูุชุฑุงุถูุฉ
            selectElement.value = '249'; 
            updateFlagAndCode('249');
        }

        // ุงูุฏุงูุฉ ุงูุนุงูุฉ ูุชุญุฏูุซ ุงูุนูู ูุญูู ุงูุฅุฏุฎุงู ูุงููุงุฆูุฉ
        function updateFlagAndCode(code, source = 'select') {
            const cleanedCode = String(code).replace('+', '').trim();
            const country = countryData.find(c => c.code === cleanedCode);
            
            if (country) {
                codeInput.value = `+${country.code}`;
                currentFlagSpan.className = `flag-icon flag-icon-${country.iso}`;
                
                // ุชุญุฏูุซ ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ููุท ุฅุฐุง ุฌุงุก ุงูุชุญุฏูุซ ูู ุงููุงุฆูุฉ ููุณูุง
                if (source === 'select') {
                    selectElement.value = country.code;
                }
            } else {
                // ุฅุฐุง ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูุนููุ ุฅุฒุงูุฉ ุงูุนูู
                currentFlagSpan.className = `flag-icon`;
            }
        }
        
        // ุงูุฏุงูุฉ ุงูุฌุฏูุฏุฉ: ุชุญุฏูุซ ุงูุนูู ุนูุฏ ุงููุชุงุจุฉ ูู ุญูู ุงูุฅุฏุฎุงู
        function checkCodeInput() {
            const code = codeInput.value.replace('+', '').trim();
            
            // ุชุญุฏูุซ ุงูุนูู ุจูุงุกู ุนูู ุงูููุฏ ุงููุฏุฎู
            updateFlagAndCode(code, 'input');
            
            // ูุณุญ ุงููููุฉ ุงููุฎุชุงุฑุฉ ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ
            selectElement.value = '';
        }

        // ูุญุงููุฉ ุชุญุฏูุฏ ุงูุฏููุฉ ุงูุชููุงุฆู ุจูุงุกู ุนูู IP (ุจุงุณุชุฎุฏุงู ุฎุฏูุฉ ูุฌุงููุฉ)
        async function fetchUserCountry() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                
                const userIso = data.country_code.toLowerCase();
                
                const detectedCountry = countryData.find(c => c.iso === userIso);
                
                if (detectedCountry) {
                    updateFlagAndCode(detectedCountry.code);
                }
            } catch (error) {
                console.error('ูุดู ูู ุฌูุจ ุงููููุน ุงูุฌุบุฑุงูู ุงูุชููุงุฆู.');
            }
        }

        function openWhatsApp() {
            const code = codeInput.value.replace('+', '').trim(); 
            const localNumber = phoneInput.value.trim().replace(/[\s+-]/g, '');

            if (!code || code.length < 1) {
                alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุฑูุฒ ุงูุฏููุฉ (ูุซุงู: 966) ูุฑูู ุงููุงุชู.');
                return;
            }
            
            if (!localNumber || localNumber.length < 6) {
                alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุฑูู ูุงุชู ูุญูู ุตุงูุญ.');
                return;
            }

            const fullNumber = code + localNumber;
            const whatsappLink = 'https://wa.me/' + fullNumber;
            
            window.open(whatsappLink, '_blank');
        }

        // ุชูููุฐ ุงูุฏูุงู ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        populateCountries();
        fetchUserCountry();

        // ************** ุชุณุฌูู Service Worker (ุงููุณุงุฑ ุงููุทูู ุงูููุซูู) **************
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // ูุณุชุฎุฏู ุงููุณุงุฑ ุงููุทูู /zool/sw.js ููู ุงูุฃูุซุฑ ููุซูููุฉ ุนูู GitHub Pages
                navigator.serviceWorker.register('/zool/sw.js', { scope: '/zool/' })
                    .then((registration) => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch((err) => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
        // ************************************************************
    </script>
</body>
</html>
